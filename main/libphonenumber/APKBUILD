# Contributor: Bhushan Shah <bshah@kde.org>
# Maintainer: Bhushan Shah <bshah@kde.org>
pkgname=libphonenumber
pkgver=8.10.13
pkgrel=0
_gtestversion=1.8.1
pkgdesc="Library for parsing, formatting, and validating international phone numbers."
url="https://github.com/googlei18n/libphonenumber"
arch="all"
license="Apache"
depends_dev="boost-dev protobuf-dev icu-dev"
makedepends="$depends_dev cmake gtest-dev"
subpackages="$pkgname-dev"
source="$pkgname-$pkgver.tar.gz::https://github.com/googlei18n/${pkgname}/archive/v${pkgver}.tar.gz
	googletest-$_gtestversion.tar.gz::https://github.com/google/googletest/archive/release-$_gtestversion.tar.gz"

build() {
	# this package doesn't play nicely when built with ccache and distcc
	# this is mainly due to usage of boost templates and gtest library which also uses the templates.
	export CCACHE_DISABLE=1
	cd "$builddir/cpp"
	if [ "$CBUILD" != "$CHOST" ]; then
		CMAKE_CROSSOPTS="-DCMAKE_SYSTEM_NAME=Linux -DCMAKE_HOST_SYSTEM_NAME=Linux"
	fi
	cmake \
		-DCMAKE_INSTALL_PREFIX=/usr \
		-DCMAKE_INSTALL_LIBDIR=lib \
		-DBUILD_SHARED_LIBS=True \
		-DCMAKE_BUILD_TYPE=Release \
		-DCMAKE_CXX_FLAGS="$CXXFLAGS" \
		-DCMAKE_C_FLAGS="$CFLAGS" \
		-DGTEST_SOURCE_DIR="$srcdir"/googletest-release-$_gtestversion/googletest \
		${CMAKE_CROSSOPTS}
	make
}

check() {
	cd "$builddir/cpp"
	./libphonenumber_test
}
package() {
	cd "$builddir/cpp"
	DESTDIR="$pkgdir" make install
}

sha512sums="84d46f1e8dac3c8daa5ca4b1f493bf909e8c7eb189749bb2ba6773c94253014ab76f871504a7201c035fe5aaabfdbcf665cdadf828925d1703595656357b9f0c  libphonenumber-8.10.13.tar.gz
e6283c667558e1fd6e49fa96e52af0e415a3c8037afe1d28b7ff1ec4c2ef8f49beb70a9327b7fc77eb4052a58c4ccad8b5260ec90e4bceeac7a46ff59c4369d7  googletest-1.8.1.tar.gz"
