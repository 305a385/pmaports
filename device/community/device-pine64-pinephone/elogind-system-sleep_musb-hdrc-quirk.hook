#!/bin/sh
set -x

musb_dev=$(ls -d /sys/bus/platform/devices/musb-hdrc.?.auto)
if ! [ -e "$musb_dev" ]; then
        echo "Could not find musb device."
        exit 1
fi
musb_dev=$(basename "$musb_dev")

case $1/$2 in
  pre/*)
    printf '%s' "$musb_dev" > /sys/bus/platform/drivers/musb-hdrc/unbind
    ;;
  post/*)
    printf '%s' "$musb_dev" > /sys/bus/platform/drivers/musb-hdrc/bind
    ;;
esac
