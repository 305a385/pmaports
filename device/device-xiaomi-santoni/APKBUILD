# Reference: <https://postmarketos.org/devicepkg>
pkgname="device-xiaomi-santoni"
pkgdesc="Xiaomi Redmi 4X"
pkgver=0.1
pkgrel=5
url="https://postmarketos.org"
license="MIT"
arch="aarch64"
options="!check !archcheck"
depends="postmarketos-base linux-xiaomi-santoni mkbootimg mesa-dri-swrast msm-fb-refresher mdss-fb-init-hack pulseaudio pulseaudio-alsa alsa-utils adsp-audio"
makedepends="devicepkg-dev"
subpackages="$pkgname-nonfree-firmware:nonfree_firmware"
source="deviceinfo
	90-device-xiaomi-santoni-audio.rules
	HiFi
	msm8920-sku7-snd-card.conf"

build() {
	devicepkg_build $startdir $pkgname
}

package() {
	devicepkg_package $startdir $pkgname

	mkdir -p "$pkgdir"/usr/share/alsa/ucm/msm8920-sku7-snd-card

	install -D -m644 "$srcdir"/HiFi \
		"$pkgdir"/usr/share/alsa/ucm/msm8920-sku7-snd-card/HiFi
	install -D -m644 "$srcdir"/msm8920-sku7-snd-card.conf \
		"$pkgdir"/usr/share/alsa/ucm/msm8920-sku7-snd-card/msm8920-sku7-snd-card.conf
	install -D -m644 "$srcdir"/90-device-xiaomi-santoni-audio.rules \
		"$pkgdir"/etc/udev/rules.d/90-device-xiaomi-santoni-audio.rules
}

nonfree_firmware() {
	pkgdesc="Wi-Fi, ADSP Firmware"
	depends="firmware-xiaomi-santoni"
	mkdir "$subpkgdir"
}

sha512sums="4a7ba291c30cc5c05cee60f1d54d026b92b270f6499ceb83111cd5c05fe6c6c8182401abc99a8c10d81f0ee95b1414fd72d0aa7f635226f44b9cf659e3cc3471  deviceinfo
f2aeed56b4442ba3d02a06fda69bfc90ffb0128488131cbc96cd1e4d0fc5d3c7e4d08478f7af2c8ee4793462e934307d6607cf4cd32e335a9b0db47f7bd1c3c6  90-device-xiaomi-santoni-audio.rules
1d2f98a9570212d3026c9565754337574ae046ad4de90265029b7e4a7cd4a2df473ca18ea41d1730f0a01046b40d343446fc88f5d70a1050e0dc578ad460f941  HiFi
6cbe9079b6eb1fc889fbb13d8b3da620b39abde3e93e2301601e5416fda8b768aa11876238378af6571ddc3c4ce662dd49f1491cbe8b96153451ffdc7b761926  msm8920-sku7-snd-card.conf"
